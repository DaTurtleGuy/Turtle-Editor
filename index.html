<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/f623b0cb4c.js" crossorigin="anonymous"></script>
    <script src="https://momentjs.com/downloads/moment.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <title>PNG Parser and Generator</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: black;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }


        .button {
            font-size: 24px;
            color: white;
            background-color: black;
            border: 2px solid white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        .button:hover {
            background-color: grey;
        }

        .select_button {
            width: 200px;
            height: 50px;
        }

        .go_back_button {
            width: 30px;
            height: 30px;
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 10;
        }

        .chats_page,
        .characters_page {
            display: none;
            color: white;
            width: 100%;
            height: 100%;
        }

        .button_container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: row;
            gap: 20px;
        }

        .tittle_container {
            color: white;
            position: fixed;
            display: flex;
            justify-content: center;
            width: 100%;
            top: 30%;
        }

        .tittle,
        .chats_title {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .centered {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .chats_page_container,
        .characters_page_container {
            width: 70%;
            height: 90%;
            border: 2px solid white;
            border-radius: 10px;
        }

        .chats_title {
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .structuredInputSection {
            max-width: 90%;
            margin-bottom: 10px;
        }

        .sectionLabel {
            margin-top: 0;
        }

        .custom-file-upload {
            display: inline-flex;
            justify-content: center;
            margin-left: 10px;
            min-height: fit-content;
            min-width: fit-content;
            padding: 5px;
        }

        .inputField {
            width: 100%;
            height: 100%;
            border: 1px solid lightgrey;
            background-color: black;
            color: #e0e0e0;
            border-radius: 5px;
            padding: 0.25rem;
        }

        .menuItems {
            display: none;
            position: relative;
            left: 0;
            width: 100%;
            height: 400px;
            border: 1px solid #ccc;
            padding: 10px;
            animation: slideDown 0.5s ease-in-out forwards;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .sectionsContainer {
            position: relative;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            margin-top: 30px;
        }

        .template {
            display: none;
        }

        input[type="file"] {
            display: none;
        }

        .messageText {
            height: 100px;
            max-width: 95%;
            overflow-y: scroll;
            resize: none;
            font-size: 16px;
        }

        .deployable_menu_wrapper {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            flex-grow: 1;
            gap: 10px;
        }

        .deployable_menu_wrapper button {
            min-width: 45%;
        }

        .convert_menu_buttons_container {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            max-width: 100%;
            width: 90%;
            height: 300px;
            height: fit-content;
            margin-top: 10px;
        }

        @media screen and (max-width: 600px) {
            .button_container {
                flex-direction: column;
                gap: 30px;
            }

            .select_button {
                width: 400px;
                height: 100px;
                font-size: 30px;
            }

            .tittle_container {
                top: 10%;
            }

            .chats_page_container,
            .characters_page_container {
                width: 100%;
                height: 100%;
                border: none;
                overflow: hidden;
            }
        }
    </style>
</head>

<body>
    <div class="template">
        <div class="individualMessageTemplate">
            <div class="messageTitle">Messsage 1</div>
            <textarea class="messageText inputField">Message 1</textarea>
        </div>
    </div>
    <div class="tittle_container" style="display: none">
        <div class="tittle">What would you like to edit?</div>
    </div>

    <div class="button_container" style="display: none">
        <button class="select_button button" id="edit_chat">Chats</button>
        <button class="select_button button" id="edit_character">
            Characters
        </button>
    </div>
    <div class="chats_page">
        <button class="go_back_button button fa fa-angle-left" onclick="goBackChatsPage()"></button>
        <div class="chats_page_container centered">
            <div class="chats_title">Chats Page</div>
            <div style="width: 100%; margin: 30px;">
                <label for="chat_upload" class="custom-file-upload button fa fa-upload"></label>
                <input id="chat_upload" type="file" />
                <div style="display: inline-flex; margin-left: 10px">
                    Upload a chat file
                </div>
            </div>

            <div class="sectionsContainer">
                <div id="currentName" class="sectionLabel"></div>
                <section class="structuredInputSection" data-is-hidden-extra="no">
                    <div class="sectionLabel">User name:</div>
                    <div>
                        <input class="inputField" id="userNameInput" data-initial-focus="no" value="" type="text"
                            placeholder="Enter user name" />
                    </div>
                </section>
                <section class="structuredInputSection" data-is-hidden-extra="no">
                    <div class="sectionLabel">Character name:</div>
                    <div>
                        <input class="inputField" data-initial-focus="no" id="characterNameInput" value="" type="text"
                            placeholder="Enter character name" />
                    </div>
                </section>
                <div class="deployable_menu">
                    <div class="deployable_menu_wrapper">
                        <button id="chatButtons" class="button" style="font-size: 15px; display: none;">Show Individual
                            Messages</button>
                        <button id="convertButton" class="button"
                            style="font-size: 15px; display: none;">Convert</button>
                    </div>
                    <div id="menuItems" class="menuItems"></div>
                </div>

                <div class="convert_menu" style="display: none">
                    <div class="convert_menu_title">To what format?</div>
                    <div class="convert_menu_buttons_container">
                        <button id="stbutton" class="button">Silly Tavern</button>
                        <button id="agnaibutton" class="button">Agnai</button>
                        <button id="moematebutton" class="button">Moemate</button>
                        <button id="risubutton" class="button"><del>Risu</del></button>
                        <button id="ttbutton" class="button">TurtleFile</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="characters_page">
        <button class="go_back_button button fa fa-angle-left" onclick="goBackCharacterPage()"></button>
        Characters Page
    </div>

    <script>
        let isJsonLGlobal = false;
        let dataGlobal = null;
        let turtleGlobalData = null;
        $(document).ready(function () {
            showSelectButtons();
            $("#edit_character").on("click", function () {
                showInfo("Coming Soon!");
                /*hideSelectButtons(function () {
                    showCharactersPage();
                });*/
            });
            $("#edit_chat").on("click", function () {
                hideSelectButtons(function () {
                    showChatsPage();
                });
            });
            $("#chat_upload").on("change", loadChatFile);



            $("#userNameInput").on("input", function () {
                updateShowMessagesButton(dataGlobal, isJsonLGlobal);
            });
            $("#characterNameInput").on("input", function () {
                updateShowMessagesButton(dataGlobal, isJsonLGlobal);
            });


            $("#chatButtons").click(function () {
                $("#menuItems").slideToggle(300, function () {
                    let buttonText = $("#chatButtons").text();
                    $("#chatButtons").text(buttonText === "Hide Individual Messages" ? "Show Individual Messages" : "Hide Individual Messages");
                });

            });

            $("#convertButton").click(function () {
                convertQuestion();
            });

            $("#ttbutton").click(function () {
                const messages = getMessages();
                const newData = {
                    dataType: "TurtleFile",
                    data: turtleGlobalData.data,
                    messages: messages
                }
                const fileName = getFileName("TurtleFile");
                downloadDictAsFile(newData, "JSON", fileName);
            });

            $("#moematebutton").click(function () {
                const messages = getMessages();
                const newData = convertFromTurtle(turtleGlobalData, "moemate");
                const fileName = getFileName("Moemate");
                downloadDictAsFile(newData, "JSON", fileName);
            });
            $("#agnaibutton").click(function () {
                const messages = getMessages();
                const newData = convertFromTurtle(turtleGlobalData, "agnai");
                const fileName = getFileName("Agnai");
                downloadDictAsFile(newData, "JSON", fileName);
            });
            $("#risubutton").click(function () {
                showInfo("Risu is currently not supported");
            })
            $("#stbutton").click(function () {
                const messages = getMessages();
                const newData = convertFromTurtle(turtleGlobalData, "sillytavern");
                const fileName = getFileName("SillyTavern");
                downloadDictAsFile(newData, "JSONL", fileName);
            })
        });


        function getFileName(platform) {
            const characterName = $("#characterNameInput").val();
            return `${platform}_${characterName}`;
        }



        function convertQuestion() {
            $(".deployable_menu").fadeOut(300, function () {
                $(".convert_menu").fadeIn(300);
            });
        }

        function showInfo(text) {
            Toastify({
                text: text,
                className: "info",
                gravity: "top",
                position: "center",
                stopOnFocus: true,
                style: {
                    background: "black",
                    border: "2px solid white",
                }

            }).showToast();
        }


        function loadChatFile() {
            const file = $("#chat_upload")[0].files[0];
            const reader = new FileReader();

            reader.onload = function (event) {
                const fileContent = event.target.result;

                // Check if the file type is JSONL
                const isJsonL = file.name.endsWith(".jsonl");

                // Parse JSON content
                let jsonData;
                if (isJsonL) {
                    // Split file content into lines
                    const lines = fileContent.trim().split("\n");

                    // Parse each line as JSON
                    jsonData = lines.map((line) => JSON.parse(line));
                } else {
                    // Otherwise, parse the entire content as JSON
                    jsonData = JSON.parse(fileContent);
                }
                // Assuming each line contains the same structure, you can access properties from the first line
                const names = getNames(jsonData, isJsonL);
                $("#userNameInput").val(names.username);
                $("#characterNameInput").val(names.characterName);
                $("#currentName").text(`Current Platform: ${names.platform}`);
                updateShowMessagesButton(jsonData, isJsonL);
                isJsonLGlobal = isJsonL;
                dataGlobal = jsonData;
            };

            reader.readAsText(file);
        }

        function updateShowMessagesButton(data, isJsonL) {
            $(".convert_menu").fadeOut(300, function () {
                $(".deployable_menu").fadeIn(300);
            })
            const username = $("#userNameInput").val();
            const characterName = $("#characterNameInput").val();
            const currentName = $("#currentName").text();
            if (username && characterName && currentName) {
                $("#chatButtons").fadeIn(500);
                $("#convertButton").fadeIn(500);
                $("#menuItems").empty();

                const convertedData = convertToTurtle(data, username, characterName, isJsonL);
                turtleGlobalData = convertedData;
                if (convertedData) {
                    let i = 0;
                    for (let message of convertedData.messages) {
                        i++;
                        let template = $(".individualMessageTemplate").clone();
                        template.removeClass("individualMessageTemplate");
                        template.addClass("individualMessage");
                        template.attr("id", i);
                        template.attr("isUser", message.is_user);
                        template.find(".messageTitle").text(`Message #${i} ${message.name}:`);
                        template.find(".messageText").val(message.mes);
                        template.attr("date", message.send_date);
                        $("#menuItems").append(template);
                    }
                }
            }
            else {
                $("#chatButtons").hide();
                $("#convertButton").hide();
            }
        }

        function getMessages() {
            let messages = [];
            $(".individualMessage").each(function () {
                let message = {
                    is_user: $(this).attr("isUser"),
                    name: $(this).find(".messageTitle").text().replace("Message #" + $(this).attr("id") + " ", "").replace(":", ""),
                    mes: $(this).find(".messageText").val(),
                    send_date: $(this).attr("date")
                };
                messages.push(message);
            });
            return messages;
        }

        function goBackCharacterPage() {
            hideCharactersPage(function () {
                showSelectButtons();
            });
        }
        function goBackChatsPage() {
            if ($(".convert_menu").is(":visible")) {
                $(".convert_menu").fadeOut(300, function () {
                    $(".deployable_menu").fadeIn(300);
                });
            }
            else {
                hideChatsPage(function () {
                    showSelectButtons();
                    $("#userNameInput").val("");
                    $("#characterNameInput").val("");
                    $("#currentName").text("");
                    $(".convert_menu").hide();
                    $("#chat_upload").files = null;
                    $("#menuItems").empty();
                    $("#chatButtons").hide();
                    $("#convertButton").hide();
                });
            }
        }

        function hideSelectButtons(callback) {
            $(".tittle_container").fadeOut(200);
            $(".button_container").fadeOut(200, function () {
                if (typeof callback === "function") {
                    callback();
                }
            });
        }

        function showSelectButtons(callback) {
            $(".tittle_container").fadeIn(300);
            $(".button_container").fadeIn(300, function () {
                if (typeof callback === "function") {
                    callback();
                }
            });
        }

        function showCharactersPage() {
            $(".characters_page").fadeIn(200);
        }
        function hideCharactersPage(callback) {
            $(".characters_page").fadeOut(200, function () {
                if (typeof callback === "function") {
                    callback();
                }
            });
        }

        function showChatsPage() {
            $(".chats_page").fadeIn(200);
        }

        function hideChatsPage(callback) {
            $(".chats_page").fadeOut(200, function () {
                if (typeof callback === "function") {
                    callback();
                }
            });
        }
    </script>

    <script>
        function sillyTavern(jsonlData, userName, characterName) {
            let data = [];

            for (let line of jsonlData) {
                data.push(line);
            }

            let newData = {
                dataType: "TurtleFile",
                data: {
                    username: userName,
                    characterName: characterName,
                },
                messages: [],
            };

            for (let line of data) {
                if ("user_name" in line && "character_name" in line) {
                    continue;
                }
                if ("name" in line && "is_user" in line) {
                    let sendDate = "";
                    if (typeof line["send_date"] === "string") {
                        sendDate = timeToMilliseconds(line["send_date"]);
                    }
                    let name = characterName;
                    if (line["is_user"]) {
                        name = userName;
                    }
                    let fileMessage = {
                        name: name,
                        is_user: line["is_user"],
                        send_date: sendDate,
                        mes: line["mes"],
                        swipes: line["swipes"] ? line["swipes"] : [],
                    };
                    newData.messages.push(fileMessage);
                }
            }

            return newData;
        }

        function moemate(jsonData, userName, characterName) {
            let data = jsonData;

            let messages = data.conversations || [];
            let newMessages = [];

            for (let message of messages) {
                let sendDate = parseInt(message.timestamp);
                let msg = message.value;
                let swipes = message.regeneratingMessages
                    ? message.regeneratingMessages.map((thing) => thing.value)
                    : [];

                let fileMessage = {
                    name: userName,
                    is_user: true,
                    send_date: sendDate,
                    mes: msg,
                    swipes: [],
                };

                if ("language" in message) {
                    newMessages.push(fileMessage);
                    continue;
                }

                fileMessage.is_user = false;
                fileMessage.name = characterName;
                fileMessage.swipes = swipes;

                newMessages.push(fileMessage);
            }

            let newData = {
                dataType: "TurtleFile",
                data: {
                    username: userName,
                    characterName: characterName,
                },
                messages: newMessages,
            };

            return newData;
        }

        function risu(jsonData, userName, characterName) {
            let data = jsonData;

            if (!userName) {
                return "user_name";
            }
            if (!characterName) {
                return "character_name";
            }

            let messages = data.data.message || [];
            let newMessages = [];

            let newData = {
                dataType: "TurtleFile",
                data: {
                    username: userName,
                    characterName: characterName,
                },
                messages: newMessages,
            };

            for (let message of messages) {
                let role = message.role;
                let sendDate = message.time;
                let msg = message.data;

                let fileMessage = {
                    name: role === "user" ? userName : characterName,
                    is_user: role === "user",
                    send_date: sendDate,
                    mes: msg,
                    swipes: [],
                };

                newMessages.push(fileMessage);
            }

            return newData;
        }

        function agnai(inputData, userName, characterName) {
            if (characterName === "") {
                return { user_name: true };
            }

            let data = inputData;
            let newMessages = [];

            let sendDate = getCurrentTime();
            let scenarioMsg = data.greeting || "";

            if (scenarioMsg) {
                let jsonLineScenario = {
                    name: characterName,
                    is_user: false,
                    send_date: sendDate,
                    mes: scenarioMsg,
                };
                newMessages.push(jsonLineScenario);
            }

            for (let message of data.messages) {
                if ("handle" in message) {
                    user_name = message.handle;
                    let msg = message.msg;
                    let jsonLine = {
                        name: user_name,
                        is_user: true,
                        send_date: sendDate,
                        mes: msg,
                        swipes: [],
                    };
                    newMessages.push(jsonLine);
                } else if ("characterId" in message) {
                    let msg = message.msg;
                    let jsonLine = {
                        name: characterName,
                        is_user: false,
                        send_date: sendDate,
                        mes: msg,
                        swipes: [],
                    };
                    newMessages.push(jsonLine);
                }
            }

            let newData = {
                dataType: "TurtleFile",
                data: {
                    username: user_name,
                    characterName: characterName,
                },
                messages: newMessages,
            };

            return newData;
        }


        function convertToTurtle(data, userName, characterName, isJsonL) {
            const platform = determinePlatform(data, isJsonL);
            if (platform === "TurtleFile") {
                return data;
            }
            if (platform === "agnai") {
                return agnai(data, userName, characterName);
            }
            if (platform === "risu") {
                return risu(data, userName, characterName);
            }
            if (platform === "moemate") {
                return moemate(data, userName, characterName);
            }
            if (platform === "sillytavern") {
                return sillyTavern(data, userName, characterName);
            }
            if (platform === "unknown") {
                return null;
            }
        }

        function determinePlatform(data, isJsonL) {
            if (data.dataType === "TurtleFile" && !isJsonL) {
                return "TurtleFile";
            }
            if (
                data.hasOwnProperty("name") &&
                data.hasOwnProperty("messages") &&
                data.hasOwnProperty("greeting") &&
                data.hasOwnProperty("sampleChat") &&
                data.hasOwnProperty("scenario")
            ) {
                let messages = data.messages;
                if (data.name === "Exported" && Array.isArray(messages)) {
                    for (let message of messages) {
                        if (message.hasOwnProperty("characterId")) {
                            return "agnai";
                        }
                    }
                }
            }

            if (data.hasOwnProperty("type") && data.type === "risuChat") {
                return "risu";
            }

            if (
                data.hasOwnProperty("memories") &&
                data.hasOwnProperty("conversations")
            ) {
                for (let item of data.conversations) {
                    if (
                        item.hasOwnProperty("user") &&
                        item.hasOwnProperty("type")
                    ) {
                        return "moemate";
                    }
                }
            }
            if (isJsonL) {
                for (let item of data) {
                    if (
                        item.hasOwnProperty("user_name") &&
                        item.hasOwnProperty("character_name") &&
                        item.hasOwnProperty("chat_metadata")
                    ) {
                        return "sillytavern";
                    } else if (
                        item.hasOwnProperty("name") &&
                        item.hasOwnProperty("is_user") &&
                        item.hasOwnProperty("is_name") &&
                        item.hasOwnProperty("send_date") &&
                        item.hasOwnProperty("mes")
                    ) {
                        return "sillytavern";
                    }

                    return "unknown";
                }
            }
        }
        function convertFromTurtle(turtleData, platform) {
            if (platform === "risu") {
                let newMessages = [];
                for (let message of turtleData.messages) {
                    if (message.is_user === true) {
                        newMessages.push({
                            role: "user",
                            data: message.mes,
                            time: message.send_date,
                            chatId: generateUuidFromString(message.mes),
                        });
                    } else if (message.is_user === false) {
                        newMessages.push({
                            role: "char",
                            data: message.mes,
                            saying: generateUuidFromString(turtleData.data.characterName),
                            time: message.send_date,
                            generationInfo: {
                                model: "gpt-3.5-turbo",
                                generationId: generateUuidFromString(
                                    message.mes + " " + turtleData.data.characterName
                                ),
                            },
                            chatId: generateUuidFromString(message.mes),
                        });
                    }
                }
                let newData = {
                    type: "risuChat",
                    ver: 1,
                    data: {
                        messages: newMessages,
                        note: "",
                        name: turtleData.name,
                        localLore: [],
                        lastMemory: "NewChat",
                        isStream: false,
                    },
                };
                return newData;
            } else if (platform === "moemate") {
                let newConversations = [];
                for (let message of turtleData.messages) {
                    newConversations.push({
                        user: message.is_user ? "@user" : turtleData.data.characterName,
                        type: "TEXT",
                        timestamp: parseInt(message.send_date),
                        value: message.mes,
                        language: "English",
                        texts: [
                            {
                                value: message.mes,
                                isCodeBlock: false,
                            },
                        ],
                    });
                }
                let newData = {
                    memories: [],
                    conversations: newConversations,
                };
                return newData;
            } else if (platform === "sillytavern") {
                let dataLines = [];
                dataLines.push({
                    user_name: turtleData.data.username,
                    character_name: turtleData.data.characterName,
                    chat_metadata: {
                        note_prompt: "",
                        note_interval: 1,
                        note_position: 1,
                        note_depth: 1,
                        objetive: {
                            objective: "",
                            tasks: [],
                            checkFrequency: "3",
                            chatDepth: "2",
                            hideTasks: false,
                        },
                    },
                });
                for (let message of turtleData.messages) {
                    let jsonLine = {
                        name: message.name,
                        is_user: message.is_user,
                        is_name: true,
                        send_date: convertTimestampToFormattedString(parseInt(message.send_date)),
                        mes: message.mes,
                        extra: {},
                    };
                    if (!message.is_user) {
                        jsonLine.swipe_id = 0;
                        jsonLine.swipes = message.swipes;
                    }
                    dataLines.push(jsonLine);
                }
                let newData = dataLines
                return newData;
            } else if (platform === "agnai") {
                let newMessages = [];
                for (let message of turtleData.messages) {
                    newMessages.push({
                        handle: turtleData.data.username,
                        userId: "",
                        msg: message.mes,
                        state: "edited",
                    });
                }
                let newData = {
                    name: "Exported",
                    greeting: "",
                    sampleChat: "",
                    scenario: "",
                    messages: newMessages,
                };
                return newData;
            }
        }

        function getNames(data, isJsonL) {
            let platform = determinePlatform(data, isJsonL);
            let output = {
                platform: platform,
                username: "",
                characterName: "",
            };
            if (platform === "agnai") {
                let messages = data.messages;
                for (let message of messages) {
                    if (message.hasOwnProperty("handle")) {
                        output.username = message.handle;
                        return output;
                    }
                }
            }
            if (platform === "risu") {
                return output;
            }
            if (platform === "sillytavern") {
                for (let message of data) {


                    if (message.hasOwnProperty("user_name")) {
                        output.username = message.user_name;
                    }
                    if (message.hasOwnProperty("character_name")) {
                        output.characterName = message.character_name;
                    }
                    if (message.hasOwnProperty("name")) {
                        if (message.is_user) {
                            output.username = message.name;
                        } else if (message.is_user === false) {
                            output.characterName = message.name;
                        }
                    }
                    if (output.username !== "" && output.characterName !== "") {
                        return output;
                    }

                    return output;
                }
            }
            if (platform === "moemate") {
                messages = data.conversations;
                for (let message of messages) {
                    if (!message.hasOwnProperty("language")) {
                        output.characterName = message.user;
                        return output;
                    }
                }
            }
            if (platform === "TurtleFile") {
                output.username = data.data.username;
                output.characterName = data.data.characterName;
                return output;
            }
        }



        function timeToMilliseconds(timeString) {
            // Parse the date string using your Silly Tavern format
            const date = moment(timeString, "MMMM Do, YYYY h:mm a");
            // Return milliseconds since epoch
            return date.valueOf();
        }

        function convertTimestampToFormattedString(timestampMilliseconds) {
            const date = new Date(timestampMilliseconds);
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            const month = months[date.getMonth()];
            const day = date.getDate();
            const year = date.getFullYear();
            const hours = date.getHours();
            const minutes = date.getMinutes();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const formattedHours = hours % 12 || 12; // Convert 0 to 12 for AM/PM format
            const formattedMinutes = minutes < 10 ? '0' + minutes : minutes; // Add leading zero for single digit minutes
            return `${month} ${day}th ${year}, ${formattedHours}:${formattedMinutes} ${ampm}`;
        }


        function getCurrentTime() {
            // Get the current moment
            const currentDateTime = moment();
            // Return milliseconds since epoch
            return currentDateTime.valueOf();
        }
        function downloadDictAsFile(dict, fileType, fileName) {
            if (fileType !== 'JSON' && fileType !== 'JSONL') {
                console.error('Invalid file type. Use "JSON" or "JSONL".');
                return;
            }

            let dataStr;

            if (fileType === 'JSON') {
                dataStr = JSON.stringify(dict, null, 2);
                fileName = `${fileName}.json`;
            } else if (fileType === 'JSONL') {
                dataStr = '';
                if (Array.isArray(dict)) {
                    dict.forEach(item => {
                        dataStr += JSON.stringify(item) + '\n';
                    });
                } else {
                    // Convert dictionary to array of single object to match JSONL format
                    dataStr = JSON.stringify(dict) + '\n';
                }
                fileName = `${fileName}.jsonl`;
            }

            // Create a blob with the data
            const blob = new Blob([dataStr], { type: 'application/json' });

            // Create a link element
            const link = document.createElement('a');

            // Set the download attribute with the file name
            link.download = fileName;

            // Create a URL for the blob and set it as the href attribute
            link.href = window.URL.createObjectURL(blob);

            // Append the link to the body (required for Firefox)
            document.body.appendChild(link);

            // Programmatically click the link to trigger the download
            link.click();

            // Remove the link from the document
            document.body.removeChild(link);
        }
    </script>
</body>

</html>